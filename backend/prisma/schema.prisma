generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model AcademicYear {
  id                    Int                 @id @default(autoincrement())
  year                  String              @unique @db.VarChar(10)
  start                 Int
  end                   Int
  isCurrent             Boolean             @default(false) @map("is_current")
  createdAt             DateTime            @default(now()) @map("created_at")
  updatedAt             DateTime            @updatedAt @map("updated_at")

  courses               Course[]
  terms                 Term[]
  plans                 Plan[]

  @@map("academic_years")
}

model Term {
  id                    Int                   @id @default(autoincrement())
  termId                String                @unique @map("term_id") @db.VarChar(20)
  academicYearId        Int                   @map("academic_year_id")
  name                  String                @db.VarChar(100)
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  academicYear          AcademicYear          @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  classes               Class[]
  sections              Section[]

  @@map("terms")
}

model Course {
  id                    Int                   @id @default(autoincrement())
  courseId              String                @unique @map("course_id") @db.VarChar(50)
  academicYearId        Int                   @map("academic_year_id")

  subjectCode           String                @map("subject_code") @db.VarChar(10)
  courseNumber          String                @map("course_number") @db.VarChar(10)
  title                 String                @db.VarChar(255)

  school                String?               @db.VarChar(255)
  creditsMin            Float                 @map("credits_min")
  creditsMax            Float                 @map("credits_max")
  typicallyOffered      String?               @map("typically_offered") @db.Text
  description           String?               @db.Text
  attributes            Json?                 @db.JsonB
  requirements          Json?                 @db.JsonB

  isCatalogCourse       Boolean               @default(true) @map("is_catalog_course")
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  academicYear          AcademicYear          @relation(fields: [academicYearId], references: [id], onDelete: Cascade)
  classes               Class[]
  plannedCourses        PlannedCourse[]

  @@unique([academicYearId, subjectCode, courseNumber])
  @@index([academicYearId, subjectCode, courseNumber])
  @@map("courses")
}

model Class {
  id                    Int                   @id @default(autoincrement())
  classId               String                @unique @map("class_id") @db.VarChar(255)
  termId                String                @map("term_id") @db.VarChar(20)
  courseId              String?               @map("course_id") @db.VarChar(50)

  subjectCode           String                @map("subject_code") @db.VarChar(10)
  courseNumber          String                @map("course_number") @db.VarChar(10)
  title                 String                @db.VarChar(255)

  school                String?               @db.VarChar(255)
  creditsMin            Float                 @map("credits_min")
  creditsMax            Float                 @map("credits_max")
  description           String?               @db.Text
  attributes            Json?                 @db.JsonB
  requirements          Json?                 @db.JsonB

  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  term                  Term                  @relation(fields: [termId], references: [termId], onDelete: Cascade)
  course                Course?               @relation(fields: [courseId], references: [courseId], onDelete: SetNull)
  sections              Section[]
  plannedCourses        PlannedCourse[]

  @@unique([termId, subjectCode, courseNumber, title])
  @@index([termId])
  @@index([courseId])
  @@map("classes")
}

model Section {
  id                    Int                   @id @default(autoincrement())
  sectionId             String                @map("section_id") @db.VarChar(255)
  termId                String                @map("term_id") @db.VarChar(20)
  classId               String                @map("class_id") @db.VarChar(255)

  sectionNumber         String                @map("section_number") @db.VarChar(20)
  sectionType           String                @map("section_type") @db.VarChar(50)

  instructors           Json                  @db.JsonB
  schedule              Json?                 @db.JsonB
  creditsMin            Float                 @map("credits_min")
  creditsMax            Float                 @map("credits_max")

  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  term                  Term                  @relation(fields: [termId], references: [termId], onDelete: Cascade)
  class                 Class                 @relation(fields: [classId], references: [classId], onDelete: Cascade)

  @@unique([termId, sectionId])
  @@index([classId])
  @@index([termId])
  @@map("sections")
}

model School {
  id                    Int                   @id @default(autoincrement())
  code                  String                @unique @db.VarChar(50)
  name                  String                @db.VarChar(255)
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  plans                 Plan[]

  @@map("schools")
}

model Plan {
  id                    Int                   @id @default(autoincrement())
  name                  String                @db.VarChar(255)
  schoolId              Int?                  @map("school_id")
  academicYearId        Int                   @map("academic_year_id")
  currentSemester       Int                   @default(0) @map("current_semester")
  isActive              Boolean               @default(true) @map("is_active")
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  school                School?               @relation(fields: [schoolId], references: [id], onDelete: SetNull)
  academicYear          AcademicYear          @relation(fields: [academicYearId], references: [id], onDelete: Restrict)
  plannedCourses        PlannedCourse[]

  @@index([schoolId])
  @@index([academicYearId])
  @@map("plans")
}

model PlannedCourse {
  id                    Int                   @id @default(autoincrement())
  planId                Int                   @map("plan_id")
  courseId              String?               @map("course_id") @db.VarChar(50)
  classId               String?               @map("class_id") @db.VarChar(255)
  semesterNumber        Int                   @map("semester_number")
  position              Int                   @default(0)
  credits               Float
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")

  plan                  Plan                  @relation(fields: [planId], references: [id], onDelete: Cascade)
  course                Course?               @relation(fields: [courseId], references: [courseId], onDelete: Cascade)
  class                 Class?                @relation(fields: [classId], references: [classId], onDelete: Cascade)

  @@unique([planId, courseId, classId])
  @@index([planId])
  @@index([courseId])
  @@index([classId])
  @@index([planId, semesterNumber, position])
  @@map("planned_courses")
}